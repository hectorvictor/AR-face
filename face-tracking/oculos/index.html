<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script> -->
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-face-aframe.prod.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function() {
        const sceneEl = document.querySelector('a-scene');
        let arSystem;
        sceneEl.addEventListener('loaded', function () {
          arSystem = sceneEl.systems["mindar-face-system"];
          if (window !== window.parent) {
            window.addEventListener('message', function(event) {
              if(event.data == 'start') {
                arSystem.start();
              } else {
                arSystem.stop();
              }
            });
          } else {
            arSystem.start();
          }
        });


        const list = ["glasses1","glasses2", "glasses3", "glasses4", "glasses5", "glasses6"];
        //const list = ["glasses1", "glasses2", "hat1", "hat2", "earring"];
        const visibles = [false, false, false, false, false, false];
        const setVisible = (button, entities, visible) => {
          if (visible) {
            button.classList.add("selected");
          } else {
            button.classList.remove("selected");
          }
            entities.forEach((entity) => {
            entity.setAttribute("visible", visible);
          });
        }
        list.forEach((item, index) => {
          const button = document.querySelector("#" + item);
          const entities = document.querySelectorAll("." + item + "-entity");
          setVisible(button, entities, false);
          button.addEventListener('click', () => {
            list.forEach((otherItem, otherIndex) => {
              if (otherIndex !== index) {
                const otherButton = document.querySelector("#" + otherItem);
                const otherEntities = document.querySelectorAll("." + otherItem + "-entity");
                visibles[otherIndex] = false;
                setVisible(otherButton, otherEntities, false);
              }
            });
            visibles[index] = !visibles[index];
            setVisible(button, entities, visibles[index]);
          });
        });

        const startButton = document.querySelector("#example-start-button");
        const stopButton = document.querySelector("#example-stop-button");
        // arReady event triggered when ready
        sceneEl.addEventListener("arReady", (event) => {
          console.log("ar ready");
        });
        // detect target found
        sceneEl.addEventListener("targetFound", event => {
          console.log("target found");
        });
        // detect target lost
        sceneEl.addEventListener("targetLost", event => {
          console.log("target lost");
        });
        // arError event triggered when something went wrong. Mostly browser compatbility issue
        sceneEl.addEventListener("arError", (event) => {
          console.log("ar error");
        });
        /* startButton.addEventListener('click', () => {
          arSystem.start(); // start AR
          startButton.disabled = true;
          stopButton.disabled = false;
        });
        stopButton.addEventListener('click', () => {
          arSystem.stop(); // stop
          startButton.disabled = false;
          stopButton.disabled = true;
        });*/
      })
    </script>
    <style>
      body {
        margin: 0;
        font-family: 'sans-serif';
      }
      .example-container {
        overflow: hidden;
        position: absolute;
        width: 100%;
        height: 100%;
      }
      .options-panel {
        position: fixed;
        left: 8;
        top: 8;
        z-index: 2;
        background-color: #fff;
        box-shadow: 3px 3px 7px 0 rgba(0, 0, 0, 0.3);
        background-color: #e6e6e6;
        border-radius: 10px;
      }

      .content__mindAR img {
        cursor: pointer;
        padding: 0px;
      }

      .content__mindAR img:not(#b42):not(#img-event) {
        width: 60px;
        height: 40px;
        object-fit: cover;
      }

      .content__mindAR img:not(#b42).selected {
        /*background-color: rgba(126, 209, 126, 0.774);*/
        background-color: #f29100;
        transform: scale(1.6);
        transition: transform .2s;
        padding-left: 2px;
      }

      .content__mindAR img:not(#b42):hover {
        background-color: #f29100;

        transform: scale(1.6);
        transition: transform .2s;
      }

      /* .content__mindAR img:not(#b42):hover {
        border: solid 1px #f29100;
        padding: 0px 13px;
      } */

      .content__mindAR {
        display: flex;
        flex-direction: column;
        justify-content: space-around;
        align-items: center;
        height: 380px;
        width: 100px;
        padding: 5px 0px;
      }

      .content__title {
        margin-bottom: 10px;
        font-size: 14px;
        font-weight: 600;
      }
      .content__mindAR__border {
        border: solid 0.1px black;
        width: 80%;
      }

      .button-menu {
        border: none;
        outline: none;
        background: none;
      }
    </style>
  </head>
  <body>
    <div class="example-container">
      <div class="options-panel">
        <div class="content__mindAR">
          <div class="content__title">Modelos</div>
          <img id="glasses1" src="../oculos/img/model1.png"/>
          <img id="glasses2" src="../oculos/img/model2.png"/>
          <img id="glasses3" src="../oculos/img/model3.png"/>
          <img id="glasses4" src="../oculos/img/model4.png"/>
          <img id="glasses5" src="../oculos/img/model5.png"/>
          <img id="glasses6" src="../oculos/img/model6.png"/>
          <!-- <div class="content__mindAR__border"></div> -->
          <!-- <button id="example-stop-button">Stop</button> -->
          <!-- <img id="hat1" src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.2.5/examples/face-tracking/assets/hat/thumbnail.png"/> -->
          <!-- <img id="hat2" src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.2.5/examples/face-tracking/assets/hat2/thumbnail.png"/> -->
          <!-- <img id="earring" src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.2.5/examples/face-tracking/assets/earring/thumbnail.png"/> -->
          <!-- <button title="Iniciar" class="button-menu" id="example-start-button">
            <img id="img-event" height="25" src="./img/video.png">
          </button> -->
          <!-- <button title="Parar" class="button-menu" id="example-stop-button">
            <img id="img-event" height="23" src="./img/stop.png">
          </button> -->
          <img style="margin-top: 10px;" id="b42" src="../oculos/img/b42.svg"/>
        </div>
      </div>
      <a-scene mindar-face="autoStart: false" embedded color-space="sRGB" renderer="colorManagement: true, physicallyCorrectLights" vr-mode-ui="enabled: false" device-orientation-permission-ui="enabled: false">
        <a-assets>
          <a-asset-item id="headModel" src="./models/headModel/headOccluder.glb"></a-asset-item>
          <a-asset-item id="glassesModel" src="./models/glasses/model1/scene.gltf"></a-asset-item>
          <a-asset-item id="glassesModel2" src="./models/glasses/model2/scene.gltf"></a-asset-item>
          <a-asset-item id="glassesModel3" src="./models/glasses/model3/scene.gltf"></a-asset-item>
          <a-asset-item id="glassesModel4" src="./models/glasses/model4/scene.gltf"></a-asset-item>
          <a-asset-item id="glassesModel5" src="./models/glasses/model5/scene.gltf"></a-asset-item>
          <a-asset-item id="glassesModel6" src="./models/glasses/model6/scene.gltf"></a-asset-item>
          <!-- <a-asset-item id="hatModel" src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.2.5/examples/face-tracking/assets/hat/scene.gltf"></a-asset-item>
          <a-asset-item id="hatModel2" src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.2.5/examples/face-tracking/assets/hat2/scene.gltf"></a-asset-item>
          <a-asset-item id="glassesModel" src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.2.5/examples/face-tracking/assets/glasses/scene.gltf"></a-asset-item>
          <a-asset-item id="glassesModel2" src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.2.5/examples/face-tracking/assets/glasses2/scene.gltf"></a-asset-item>
          <a-asset-item id="earringModel" src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.2.5/examples/face-tracking/assets/earring/scene.gltf"></a-asset-item> -->
        </a-assets>
        <a-camera active="false" position="0 0 0" look-controls="enabled: false"></a-camera>
        <!-- head occluder -->
        <a-entity mindar-face-target="anchorIndex: 168">

          <!-- mindar-face-occluder -->
          <a-gltf-model mindar-face-occluder position="0 -0.3 0" rotation="1 0 0" scale="0.071 0.071 0.071" src="#headModel"></a-gltf-model>
        </a-entity>

        <a-entity mindar-face-target="anchorIndex: 168">
          <a-gltf-model visible="false" class="glasses1-entity" rotation="0 270 -2" position="0.02 -0.5 -0.01" scale="0.093 0.095 0.088" src="#glassesModel"></a-gltf-model>
        </a-entity>
        <a-entity mindar-face-target="anchorIndex: 168">
          <a-gltf-model visible="false" class="glasses2-entity" rotation="0 89 4" position="0 -0.25 0" scale="0.06 0.05 0.058" src="#glassesModel2"></a-gltf-model>
        </a-entity>
        <a-entity mindar-face-target="anchorIndex: 168">
          <a-gltf-model visible="false" class="glasses3-entity" rotation="3 0 0" position="0 -0.08 0" scale="0.74 0.69 1.25" src="#glassesModel3"></a-gltf-model>
        </a-entity>
        <a-entity mindar-face-target="anchorIndex: 168">
          <a-gltf-model visible="false" class="glasses4-entity" rotation="6 0 0" position="0 0.03 -0.2" scale="0.0415 0.0415 0.052" src="#glassesModel4"></a-gltf-model>
        </a-entity>
        <a-entity mindar-face-target="anchorIndex: 168">
          <a-gltf-model visible="false" class="glasses5-entity" rotation="2 0 0" position="0 -0.2 -0.58" scale="0.76 0.76 0.82" src="#glassesModel5"></a-gltf-model>
        </a-entity>
        <a-entity mindar-face-target="anchorIndex: 168">
          <a-gltf-model visible="false" class="glasses6-entity" rotation="5 0 0" position="0 -0.32 -0.21" scale="0.074 0.074 0.102" src="#glassesModel6"></a-gltf-model>
        </a-entity>
      </a-scene>
    </div>
  </body>
</html>